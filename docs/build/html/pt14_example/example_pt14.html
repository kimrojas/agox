
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pt14-Au (EMT): Runscript &#8212; AGOX 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pyramid.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pt14-Au (EMT): Submission" href="example_pt14_slurm.html" />
    <link rel="prev" title="Introduction to AGOX" href="../introduction.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="example_pt14_slurm.html" title="Pt14-Au (EMT): Submission"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to AGOX"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">AGOX 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Pt14-Au (EMT): Runscript</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pt14-au-emt-runscript">
<h1>Pt14-Au (EMT): Runscript<a class="headerlink" href="#pt14-au-emt-runscript" title="Permalink to this headline">¶</a></h1>
<p>In this example we want to employ AGOX to find the global minimum structure of 14 platinum atoms on a
gold surface.</p>
<section id="full-runscript">
<h2>Full runscript<a class="headerlink" href="#full-runscript" title="Permalink to this headline">¶</a></h2>
<p>The runscript for this looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">read</span><span class="p">,</span> <span class="n">write</span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">fcc100</span> 
<span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span>

<span class="c1"># Common AGOX</span>
<span class="kn">from</span> <span class="nn">agox.main_agox</span> <span class="kn">import</span> <span class="n">AGOX</span>
<span class="kn">from</span> <span class="nn">agox.modules.databases</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="kn">from</span> <span class="nn">agox.modules.environments.environment_singular</span> <span class="kn">import</span> <span class="n">EnvironmentSingular</span>
<span class="kn">from</span> <span class="nn">agox.modules.acquisitors.acquisitor_LCB</span> <span class="kn">import</span> <span class="n">LowerConfidenceBoundAcquisitor</span>
<span class="kn">from</span> <span class="nn">agox.modules.models.model_GPR</span> <span class="kn">import</span> <span class="n">ModelGPR</span>
<span class="kn">from</span> <span class="nn">agox.modules.models.gaussian_process.default_model_gofee</span> <span class="kn">import</span> <span class="n">get_default_GPR_model</span>
<span class="kn">from</span> <span class="nn">agox.modules.acquisitors.gauges.energy_gauge</span> <span class="kn">import</span> <span class="n">EnergyGauge</span>
<span class="kn">from</span> <span class="nn">agox.modules.collectors</span> <span class="kn">import</span> <span class="n">TimeDependentCollector</span>
<span class="kn">from</span> <span class="nn">agox.modules.generators</span> <span class="kn">import</span> <span class="n">RattleGenerator</span><span class="p">,</span> <span class="n">StartGenerator</span><span class="p">,</span> <span class="n">HemisphereGenerator</span><span class="p">,</span> <span class="n">ReplaceGenerator</span>
<span class="kn">from</span> <span class="nn">agox.modules.generators.replace_generator_bias</span> <span class="kn">import</span> <span class="n">BiasedReplaceGenerator</span>
<span class="kn">from</span> <span class="nn">agox.modules.generators.rattle_generator_bias</span> <span class="kn">import</span> <span class="n">BiasedRattleGenerator</span>
<span class="kn">from</span> <span class="nn">agox.modules.postprocessors.postprocess_io_relax</span> <span class="kn">import</span> <span class="n">PrimaryPostProcessIORelax</span>
<span class="kn">from</span> <span class="nn">agox.modules.samplers.sampler_kmeans</span> <span class="kn">import</span> <span class="n">SamplerKMeans</span>
<span class="kn">from</span> <span class="nn">agox.modules.postprocessors.constraints.box_constraint</span> <span class="kn">import</span> <span class="n">BoxConstraint</span>

<span class="c1">################################################################################################</span>
<span class="c1"># Input arguments</span>
<span class="c1">################################################################################################</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--index&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>    
<span class="n">run_idx</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span>

<span class="c1">################################################################################################</span>
<span class="c1"># General settings:</span>
<span class="c1">################################################################################################</span>

<span class="n">template</span> <span class="o">=</span> <span class="n">fcc100</span><span class="p">(</span><span class="s1">&#39;Au&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">vacuum</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">environment</span> <span class="o">=</span> <span class="n">EnvironmentSingular</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Pt14&#39;</span><span class="p">)</span>

<span class="c1"># Database</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="s1">&#39;db</span><span class="si">{}</span><span class="s1">.db&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run_idx</span><span class="p">)</span>
<span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>

<span class="c1">################################################################################################</span>
<span class="c1"># Model / Acquisitor</span>
<span class="c1">################################################################################################</span>

<span class="n">lambda1min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">lambda1max</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">lambda1ini</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda1max</span> <span class="o">-</span> <span class="n">lambda1min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lambda1min</span>
<span class="n">lambda2min</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span> <span class="n">lambda2max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">lambda2ini</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda2max</span> <span class="o">-</span> <span class="n">lambda2min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lambda2min</span>
<span class="n">theta0min</span> <span class="o">=</span> <span class="mf">1e0</span><span class="p">;</span> <span class="n">theta0max</span> <span class="o">=</span> <span class="mf">1e5</span><span class="p">;</span> <span class="n">theta0ini</span> <span class="o">=</span> <span class="mi">5000</span>                         

<span class="n">hyperparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lambda1min&#39;</span><span class="p">:</span><span class="n">lambda1min</span><span class="p">,</span> <span class="s1">&#39;lambda1max&#39;</span><span class="p">:</span><span class="n">lambda1max</span><span class="p">,</span> <span class="s1">&#39;lambda1ini&#39;</span><span class="p">:</span><span class="n">lambda1ini</span><span class="p">,</span>
               <span class="s1">&#39;lambda2min&#39;</span><span class="p">:</span><span class="n">lambda2min</span><span class="p">,</span> <span class="s1">&#39;lambda2max&#39;</span><span class="p">:</span><span class="n">lambda2max</span><span class="p">,</span> <span class="s1">&#39;lambda2ini&#39;</span><span class="p">:</span><span class="n">lambda2ini</span><span class="p">,</span> 
               <span class="s1">&#39;theta0min&#39;</span><span class="p">:</span><span class="n">theta0min</span><span class="p">,</span> <span class="s1">&#39;theta0max&#39;</span><span class="p">:</span><span class="n">theta0max</span><span class="p">,</span> <span class="s1">&#39;theta0ini&#39;</span><span class="p">:</span><span class="n">theta0ini</span><span class="p">}</span>
            
<span class="n">model</span><span class="p">,</span> <span class="n">feature_calc</span> <span class="o">=</span> <span class="n">get_default_GPR_model</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">use_delta_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_feature_calc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hyperparams</span><span class="p">)</span>
<span class="n">model_calculator</span> <span class="o">=</span> <span class="n">ModelGPR</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">update_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">optimize_frequency</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">optimize_loglikelyhood</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_saved_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
<span class="n">gauges</span> <span class="o">=</span> <span class="p">[</span><span class="n">EnergyGauge</span><span class="p">(</span><span class="n">calc</span><span class="p">)]</span>
<span class="n">acquisitor</span> <span class="o">=</span> <span class="n">LowerConfidenceBoundAcquisitor</span><span class="p">(</span><span class="n">model_calculator</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gauges</span><span class="o">=</span><span class="n">gauges</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">################################################################################################</span>
<span class="c1"># Generator / Collector / Sampler </span>
<span class="c1">################################################################################################</span>

<span class="n">fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">confinement_cell</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="o">*</span> <span class="n">fractions</span><span class="o">.</span><span class="n">T</span>
<span class="n">cell_corner</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">cell_corner</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
<span class="n">confinement_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">start_generator</span> <span class="o">=</span> <span class="n">StartGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">,</span> <span class="n">may_nucleate_at_several_places</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rattle_generator</span> <span class="o">=</span> <span class="n">RattleGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">)</span>
<span class="n">replace_generator</span> <span class="o">=</span> <span class="n">BiasedReplaceGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">)</span>

<span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_generator</span><span class="p">,</span> <span class="n">rattle_generator</span><span class="p">,</span> <span class="n">replace_generator</span><span class="p">]</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>

<span class="n">BC</span> <span class="o">=</span> <span class="n">BoxConstraint</span><span class="p">(</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">get_missing_indices</span><span class="p">())</span>
<span class="n">relaxer</span> <span class="o">=</span> <span class="n">PrimaryPostProcessIORelax</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">acquisitor</span><span class="o">.</span><span class="n">get_acquisition_calculator</span><span class="p">(),</span> <span class="n">start_relax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sleep_timing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                                        <span class="n">optimizer_run_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fmax&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">},</span> <span class="n">model_training_mode</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> 
                                        <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;logfile&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span> 
                                        <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">BC</span><span class="p">])</span>
                                        
<span class="n">postprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">relaxer</span><span class="p">]</span>

<span class="c1"># Ensemble </span>
<span class="n">collector</span> <span class="o">=</span> <span class="n">TimeDependentCollector</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="n">generators</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">postprocessors</span><span class="o">=</span><span class="n">postprocessors</span><span class="p">,</span> <span class="n">report_timing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">SamplerKMeans</span><span class="p">(</span><span class="n">feature_calc</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_energy</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">use_saved_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">################################################################################################</span>
<span class="c1"># Let get the show running! </span>
<span class="c1">################################################################################################</span>

<span class="n">agox</span> <span class="o">=</span> <span class="n">AGOX</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span> 
            <span class="n">acquisitor</span><span class="o">=</span><span class="n">acquisitor</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">run_idx</span><span class="p">)</span>

<span class="n">agox</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">N_episodes</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>So about 120 lines of code to setup the search.</p>
</section>
<section id="walkthrough">
<h2>Walkthrough<a class="headerlink" href="#walkthrough" title="Permalink to this headline">¶</a></h2>
<p>The first many lines are just import statements that are not too interesting. The first lines that are interesting
are</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">=</span> <span class="n">fcc100</span><span class="p">(</span><span class="s1">&#39;Au&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">vacuum</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">environment</span> <span class="o">=</span> <span class="n">EnvironmentSingular</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Pt14&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the template gold surface is defined and the environment module of AGOX is setup using this
template with the specification that the search places 14 Pt atoms.</p>
<p>Next the GPR model and lower-confidence-bound acquisitor are defined</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">,</span> <span class="n">feature_calc</span> <span class="o">=</span> <span class="n">get_default_GPR_model</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">use_delta_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_feature_calc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">hyperparams</span><span class="p">)</span>
<span class="n">model_calculator</span> <span class="o">=</span> <span class="n">ModelGPR</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">update_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">optimize_frequency</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">optimize_loglikelyhood</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_saved_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
<span class="n">gauges</span> <span class="o">=</span> <span class="p">[</span><span class="n">EnergyGauge</span><span class="p">(</span><span class="n">calc</span><span class="p">)]</span>
<span class="n">acquisitor</span> <span class="o">=</span> <span class="n">LowerConfidenceBoundAcquisitor</span><span class="p">(</span><span class="n">model_calculator</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gauges</span><span class="o">=</span><span class="n">gauges</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The acquisitor is given both the model and a list of guages, which here only contains an EnergyGauge that
uses the EMT calculator from ASE. The acquisitor uses the given model to decide on which candidate to
evaluate with the given guages.</p>
<p>Before the generators are defined a confinement cell is defined</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">confinement_cell</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="o">*</span> <span class="n">fractions</span><span class="o">.</span><span class="n">T</span>
<span class="n">cell_corner</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">cell_corner</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
<span class="n">confinement_cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>This is used by generators to confine the volume in which the atoms will be placed, in this case
the atoms are confined to the center area of the cell in the XY-plane and can only be placed
on the upper-side of the gold template.</p>
<p>Next the generators are defined</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_generator</span> <span class="o">=</span> <span class="n">StartGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">,</span> <span class="n">may_nucleate_at_several_places</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rattle_generator</span> <span class="o">=</span> <span class="n">RattleGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">)</span>
<span class="n">replace_generator</span> <span class="o">=</span> <span class="n">BiasedReplaceGenerator</span><span class="p">(</span><span class="n">confinement_cell</span><span class="o">=</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="o">=</span><span class="n">cell_corner</span><span class="p">)</span>

<span class="n">generators</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_generator</span><span class="p">,</span> <span class="n">rattle_generator</span><span class="p">,</span> <span class="n">replace_generator</span><span class="p">]</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
</pre></div>
</div>
<p>Here three types of generators are initiated and gathered in a list that will later be given to the
collector module alongside the num_samples dictionary that controls how many candidates are generated
using each of the generators.</p>
<p>To apply model relaxation a postprocessor is defined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BC</span> <span class="o">=</span> <span class="n">BoxConstraint</span><span class="p">(</span><span class="n">confinement_cell</span><span class="p">,</span> <span class="n">cell_corner</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">get_missing_indices</span><span class="p">())</span>
<span class="n">relaxer</span> <span class="o">=</span> <span class="n">PrimaryPostProcessIORelax</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">acquisitor</span><span class="o">.</span><span class="n">get_acquisition_calculator</span><span class="p">(),</span> <span class="n">start_relax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sleep_timing</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                                        <span class="n">optimizer_run_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fmax&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;steps&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">},</span> <span class="n">model_training_mode</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> 
                                        <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;logfile&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span> 
                                        <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">BC</span><span class="p">])</span>
                                        
<span class="n">postprocessors</span> <span class="o">=</span> <span class="p">[</span><span class="n">relaxer</span><span class="p">]</span>
</pre></div>
</div>
<p>The BoxConstraint ensures the relaxation obeys the same confinement as the generators. Next the relaxer
is defined, note that it does not use the bare GPR model but rather it obtains a calculator from the acquisitor.
This makes it so that relaxation happens in the lower-confidence-bound landscape rather than the pure GPR model energy
landscape.</p>
<p>Finally the main AGOX object is initialized using the defined modules and the search is started and will run for 1000 episodes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agox</span> <span class="o">=</span> <span class="n">AGOX</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span> 
            <span class="n">acquisitor</span><span class="o">=</span><span class="n">acquisitor</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">run_idx</span><span class="p">)</span>

<span class="n">agox</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">N_episodes</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>The script produces a number of files, some of which are plots of the confinement limits such as this one
generated for the StartGenerator</p>
<figure class="align-default">
<img alt="../_images/confinement_plot_StartGenerator.png" src="../_images/confinement_plot_StartGenerator.png" />
</figure>
<p>When setting up new systems it is worthwhile to look at these plots to make sure the confinement is as
expected!</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to AGOX</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pt14-Au (EMT): Runscript</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#full-runscript">Full runscript</a></li>
<li class="toctree-l2"><a class="reference internal" href="#walkthrough">Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_pt14_slurm.html">Pt14-Au (EMT): Submission</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pt14_analysis.html">Pt14-Au (EMT): Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observers.html">Observers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abstract_base_classes.html">Abstract Base Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inheritance_generator/example.html">Inheritance: An example</a></li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../introduction.html"
                          title="previous chapter">Introduction to AGOX</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="example_pt14_slurm.html"
                          title="next chapter">Pt14-Au (EMT): Submission</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/pt14_example/example_pt14.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="example_pt14_slurm.html" title="Pt14-Au (EMT): Submission"
             >next</a> |</li>
        <li class="right" >
          <a href="../introduction.html" title="Introduction to AGOX"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">AGOX 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Pt14-Au (EMT): Runscript</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Mads-Peter.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>